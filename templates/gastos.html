{% extends "base.html" %}

{% block titulo %}Gestión de Gastos{% endblock %}

{% block contenido %}
<h2>Registro de Ingresos y Gastos</h2>

<!-- Formulario para registrar ingreso/gasto -->
<form method="POST" action="{{ url_for('gastos') }}" class="form-gastos">
  <input type="date" name="fecha" required>
  <input type="text" name="descripcion" placeholder="Descripción" required>
  <input type="number" name="valor" step="0.01" placeholder="Valor" required>
  <select name="tipo" required>
    <option value="ingreso">Ingreso</option>
    <option value="gasto">Gasto</option>
  </select>
  <button type="submit">Registrar</button>
</form>

<hr>

<!-- Tabla resumen -->
<h3>Historial del Mes</h3>
<table border="1">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Descripción</th>
      <th>Valor</th>
      <th>Tipo</th>
    </tr>
  </thead>
  <tbody>
    {% for item in gastos %}
      <tr>
        <td>{{ item.fecha }}</td>
        <td>{{ item.descripcion }}</td>
        <td>${{ "%.2f"|format(item.valor) }}</td>
        <td>{{ item.tipo|capitalize }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Gráficas con Chart.js -->
<h3 style="margin-top: 40px;">Estadísticas del Mes</h3>
<canvas id="graficoGastos" width="400" height="200"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('graficoGastos').getContext('2d');
  const grafico = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ etiquetas | tojson }},
      datasets: [
        {
          label: 'Ingresos',
          data: {{ ingresos | tojson }},
          backgroundColor: 'rgba(75, 192, 192, 0.6)'
        },
        {
          label: 'Gastos',
          data: {{ egresos | tojson }},
          backgroundColor: 'rgba(255, 99, 132, 0.6)'
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}
