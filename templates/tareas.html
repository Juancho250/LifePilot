{% extends "base.html" %}
{% block titulo %}Tareas{% endblock %}

{% block contenido %}
<h2>Tablero Kanban</h2>

<form method="POST" action="{{ url_for('tareas') }}" class="kanban-form">
  <input type="text" name="titulo" placeholder="Nueva tarea" required>
  <input type="date" name="fecha_limite">
  <button type="submit">Agregar</button>
</form>

<div class="kanban-board">
  <div class="kanban-column">
    <h3>Por Hacer</h3>
    <div class="kanban-tasks" id="todo">
      {% for tarea in tareas %}
        {% if tarea.estado == 'todo' %}
          <div class="kanban-task" draggable="true">{{ tarea.titulo }}</div>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="kanban-column">
    <h3>En Proceso</h3>
    <div class="kanban-tasks" id="in-progress">
      {% for tarea in tareas %}
        {% if tarea.estado == 'in-progress' %}
          <div class="kanban-task" draggable="true">{{ tarea.titulo }}</div>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="kanban-column">
    <h3>Completado</h3>
    <div class="kanban-tasks" id="done">
      {% for tarea in tareas %}
        {% if tarea.estado == 'done' %}
          <div class="kanban-task" draggable="true">{{ tarea.titulo }}</div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<!-- FullCalendar -->
<h2 style="margin-top: 40px;">Calendario de Tareas</h2>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<div id="calendar"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'es',
    events: [
      {% for tarea in tareas %}
        {% if tarea.fecha_limite %}
        {
          title: '{{ tarea.titulo|escape }}',
          start: '{{ tarea.fecha_limite }}',
          color: '{{ "green" if tarea.estado == "done" else ("orange" if tarea.estado == "in-progress" else "red") }}'
        }{% if not loop.last %},{% endif %}
        {% endif %}
      {% endfor %}
    ]
  });
  calendar.render();
});
</script>

{% endblock %}
